#include <string.h>
#include <stdio.h>
#include <stdlib.h>

//gcc -o heap_overflow heap_overflow.c -no-pie -Wall

struct users{
	char username[10];
};

int main(int argc, char **argv){
	system("clear");
	puts("\n[Heap Overflow Vulnerability]");
	puts("------------------------------");
	
	fprintf(stderr, "- The aim of this program is to demonstrate our heap overflow vulnerability.\n");
	fprintf(stderr, "- We start by allocating 2 users chunks on the heap.\n- These are:\n\t [struct users *user]\n\t [struct users *root]\n\n");
	
	struct users *user = malloc(sizeof(struct users));
	struct users *root = malloc(sizeof(struct users));

	strcpy(root -> username, "root");
	fprintf(stderr, "- The aim is to change the value of [root->username] to admin\n");
	fprintf(stderr, "- Before overflow:\n\t[root->username] == (%s)\n", root->username);
	
	sprintf(user -> username, "%s", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAadmin\0"); // This is where the heap overflow happens.
	fprintf(stderr, "- After Overflow:\n\t[root->username] == (%s)\n", root->username);
		
	return 0;
}
